---
spec_version: '1.0'
indicators:
  throughput: "metricSelector=builtin:service.requestCount.total:merge(dt.entity.service):sum&entitySelector=type(SERVICE),tag([Kubernetes]app:$SERVICE),tag([CONTEXTLESS]env:$STAGE)"
  error_rate: "metricSelector=builtin:service.errors.total.rate:merge(dt.entity.service):avg&entitySelector=type(SERVICE),tag([Kubernetes]app:$SERVICE),tag([CONTEXTLESS]env:$STAGE)"
  response_time_p50: "metricSelector=builtin:service.response.time:merge(dt.entity.service):percentile(50)&entitySelector=type(SERVICE),tag([Kubernetes]app:$SERVICE),tag([CONTEXTLESS]env:$STAGE)"
  response_time_p90: "metricSelector=builtin:service.response.time:merge(dt.entity.service):percentile(90)&entitySelector=type(SERVICE),tag([Kubernetes]app:$SERVICE),tag([CONTEXTLESS]env:$STAGE)"
  response_time_p95: "metricSelector=builtin:service.response.time:merge(dt.entity.service):percentile(95)&entitySelector=type(SERVICE),tag([Kubernetes]app:$SERVICE),tag([CONTEXTLESS]env:$STAGE)"
  sv_cpu_container_p90: metricSelector=builtin:containers.cpu.usagePercent:filter(and(or(in("dt.entity.container_group_instance",entitySelector("type(container_group_instance),tag(~"app:segmentation-api~")")),in("dt.entity.container_group_instance",entitySelector("type(container_group_instance),tag(~"env:pt~")"))))):splitBy():percentile(90):auto:sort(value(percentile(90),descending)):limit(10)
  sv_cpu_container_avg: metricSelector=builtin:containers.cpu.usagePercent:filter(and(or(in("dt.entity.container_group_instance",entitySelector("type(container_group_instance),tag(~"env:pt~")")),in("dt.entity.container_group_instance",entitySelector("type(container_group_instance),tag(~"app:segmentation-api~")"))))):splitBy():avg:auto:sort(value(avg,descending)):limit(10)
  sv_memory_container_p90: metricSelector=builtin:containers.memory.usagePercent:filter(and(or(in("dt.entity.container_group_instance",entitySelector("type(container_group_instance),tag(~"env:pt~")")),in("dt.entity.container_group_instance",entitySelector("type(container_group_instance),tag(~"app:segmentation-api~")"))))):splitBy():percentile(90):auto:sort(value(percentile(90),descending)):limit(10)
  sv_memory_container_avg: metricSelector=builtin:containers.memory.usagePercent:filter(and(or(in("dt.entity.container_group_instance",entitySelector("type(container_group_instance),tag(~"env:pt~")")),in("dt.entity.container_group_instance",entitySelector("type(container_group_instance),tag(~"app:segmentation-api~")"))))):splitBy():avg:auto:sort(value(avg,descending)):limit(10)
  sv_response_time_email_p90: MV2;MicroSecond;metricSelector=builtin:service.keyRequest.response.time:filter(and(in("dt.entity.service_method",entitySelector("type(service_method),entityId(~"SERVICE_METHOD-6A6EB5F9234198D9~")")))):splitBy("dt.entity.service_method"):percentile(90)
  sv_response_time_sms_p90: MV2;MicroSecond;metricSelector=builtin:service.keyRequest.response.time:filter(and(in("dt.entity.service_method",entitySelector("type(service_method),entityId(~"SERVICE_METHOD-DEDF031D9580ADD7~")")))):splitBy("dt.entity.service_method"):percentile(90)
  sv_response_time_email_p50: MV2;MicroSecond;metricSelector=builtin:service.keyRequest.response.time:filter(and(in("dt.entity.service_method",entitySelector("type(service_method),entityId(~"SERVICE_METHOD-6A6EB5F9234198D9~")")))):splitBy("dt.entity.service_method"):percentile(50)
  sv_response_time_sms_p50: MV2;MicroSecond;metricSelector=builtin:service.keyRequest.response.time:filter(and(in("dt.entity.service_method",entitySelector("type(service_method),entityId(~"SERVICE_METHOD-DEDF031D9580ADD7~")")))):splitBy("dt.entity.service_method"):percentile(50)